{% extends "layout.html" %}
{% block title %}Index{% endblock %}
{% block head %}
{{ super() }}
{% endblock %}
{% block content %}
<div class="row">
    <div class="col-md-2">
    </div>
    <div class="col-md-8" style="color: white">
        <ul id="tabs" class="nav nav-tabs" data-tabs="tabs">
            <li role="presentation" class="active" ><a href="#sysOverview" data-toggle="tab">系统概要</a></li>
            <li role="presentation"><a href="#volumeM" data-toggle="tab">存储卷管理</a></li>
            <li role="presentation"><a href="#sysM" data-toggle="tab">系统管理</a></li>
            <li role="presentation"><a href="#monitorM" data-toggle="tab">监控管理</a></li>
            <li role="presentation"><a href="#help" data-toggle="tab">帮助</a></li>
        </ul>
    </div>
    <div class="col-md-2">
    </div>

</div>
<div class="row" style="margin-top: 20px">
    <div id="my-tab-content" class="tab-content">
        <div class="tab-pane active" id="sysOverview">
            <div class="row">
                <div class="col-md-2"></div>
                <div class="col-md-4">
                    <!-- 饼图 -->
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <i class="fa fa-bar-chart-o"></i>

                            <h3 class="box-title">系统容量</h3>

                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="box-body">
                            <div id="sysUsage" style="height: 300px;"></div>
                        </div>
                        <!-- /.box-body-->
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="info-box">
                        <span class="info-box-icon bg-aqua"><i class="fa fa-cubes"></i></span>

                        <div class="info-box-content" style="color: black">
                            <span class="info-box-text">总容量</span>
                            <span class="info-box-number" id="sysTotal">200TB</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                    <div class="info-box">
                        <span class="info-box-icon bg-aqua"><i class="fa fa-cube"></i></span>

                        <div class="info-box-content" style="color: black">
                            <span class="info-box-text">剩余容量</span>
                            <span class="info-box-number" id="sysFree">160TB</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                    <div class="info-box">
                        <span class="info-box-icon bg-aqua"><i class="fa fa-database"></i></span>

                        <div class="info-box-content" style="color: black">
                            <span class="info-box-text">总存储卷数目</span>
                            <span class="info-box-number" id="volumeNumber">3</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                </div>
                <div class="col-md-2"></div>
            </div>
            <div class="row">
                <div class="col-md-2"></div>
                <div class="col-md-8">
                    <div class="box">
                        <div class="box-header with-border">
                            <h3 class="box-title">磁盘卷信息</h3>
                        </div>
                        <!-- /.box-header -->
                        <div class="box-body table-responsive no-padding" style="color: black;">
                            <table data-toggle="table" id="volumeList" data-unique-id="volumeName">
                                <thead>
                                <tr>
                                    <th data-align="center" data-field="volumeName">卷名称</th>
                                    <th data-align="center" data-field="status">状态</th>
                                    <th data-align="center" data-field="capacity">容量</th>
                                    <th data-align="center" data-field="NFS">NFS</th>
                                    <th data-align="center" data-field="Samba">Samba</th>
                                    <th data-align="center" data-field="iSCSI">iSCSI</th>
                                    <th data-align="center" data-field="Swift">Swift</th>
                                </tr>
                                </thead>
                                <tbody>

                                </tbody>
                            </table>
                        </div>
                        <!-- /.box-body -->
                    </div>
                </div>
                <div class="col-md-2"></div>
            </div>
        </div>
        <div class="tab-pane" id="volumeM" style="color: black">
            <div class="col-md-2">
                <div class="row">

                    <div class="text-right" style="margin-bottom: 10px">
                        <div class="btn-group">
                            <button type="button" class="btn btn-danger btn-sm" id="removeVolume" data-toggle="modal" data-target="#removeConfirmM" disabled>删除</button>
                            <button type="button" class="btn btn-primary btn-sm" id="refreshVolume"><i class="fa fa-refresh"></i></button>
                            <button type="button" class="btn btn-primary btn-sm" id="addVolume" data-toggle="modal" data-target="#addVolumeM"><i class="fa fa-plus"></i></button>
                        </div>
                    </div>
                </div>
                <div class="box box-primary" style="background-color: white;margin-left: 20px">
                    <div class="box-header with-border">
                        <h3 class="box-title" style="text-align: center">存储卷</h3>
                        <div class="box-tools">
                            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="box-body no-padding">
                        <ul class="nav nav-stacked" data-toggle="tabs" id="volumeTabs">
                            <li role="presentation"><a href="#c" data-toggle="tab">volumeI</a></li>
                        </ul>
                    </div>
                    <!-- /.box-body -->
                </div>
            </div>
            <div class="col-md-8">
                <h3 id="noVolume">没有存储卷,请点击添加.</h3>
                <div class="tab-content" id="volumeContent">
                    <div id="c" class="tab-pane">
                        <div class="row">
                            <div class="col-md-3">
                                <!-- 饼状图 -->
                                <div class="box box-primary">
                                    <div class="box-header with-border">
                                        <i class="fa fa-bar-chart-o"></i>

                                        <h3 class="box-title">存储卷容量</h3>

                                        <div class="box-tools pull-right">
                                            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="box-body">
                                        <div id="volumeUsage" style="height: 150px; width:100%"></div>
                                    </div>
                                    <!-- /.box-body-->
                                </div>
                            </div>
                            <div class="col-md-9">
                                <!-- 读写速度 -->
                                <!-- interactive chart -->
                                <div class="box box-primary">
                                    <div class="box-header with-border">
                                        <i class="fa fa-bar-chart-o"></i>

                                        <h3 class="box-title">IO读写速度</h3>
                                        <div class="box-tools pull-right">
                                            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="box-body" id="rwBox">
                                        <div id="rwSpeed" style="height: 150px; width: 100%"></div>
                                    </div>
                                    <!-- /.box-body-->
                                </div>
                                <!-- /.box -->
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-5">
                                <div class="box box-primary">
                                    <div class="box-header with-border">
                                        <h3 class="box-title">存储卷操作</h3>
                                    </div>
                                    <!-- /.box-header -->
                                    <div class="box-body table-responsive no-padding" style="color: black;height: 158px">
                                        <div class="row" style="text-align: center;margin-top: 39px;width: 100%">
                                            <button class="btn btn-app" disabled>
                                                <i class="fa fa-play"></i> 启动
                                            </button>
                                            <button class="btn btn-app">
                                                <i class="fa fa-repeat"></i> 重启
                                            </button>
                                            <button class="btn btn-app">
                                                <i class="fa fa-pause"></i> 停止
                                            </button>

                                        </div>
                                    </div>
                                    <!-- /.box-body -->
                                </div>

                            </div>
                            <div class="col-md-7">
                                <table data-toggle="table" data-unique-id="client" id="table_test">
                                    <thead>
                                    <tr>
                                        <th data-align="center" data-field="ck"></th>
                                        <th data-align="center" data-field="client">客户端</th>
                                        <th data-align="center" data-field="address">网址</th>
                                        <th data-align="center" data-field="username">用户名</th>
                                        <th data-align="center" data-field="password">密码</th>
                                    </tr>
                                    </thead>
                                    <tbody>

                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="row">
                            <div class="box">
                                <div class="box-header">
                                    <h3 class="box-title">存储设备</h3>
                                </div>
                                <div class="box-body">
                                    <a class="btn btn-app" rel="tooltip" title="存储设备名称: 166.111.131.144:/few/fe<br>状态: 在线" data-html="true">
                                        <i class="fa fa-database text-danger"></i>块名称
                                    </a>
                                    <a class="btn btn-app" rel="tooltip" title="存储设备名称: 166.111.131.144:/few/fe<br>状态: 在线" data-html="true">
                                        <i class="fa fa-database text-success"></i>块名称
                                    </a>
                                    <a class="btn btn-app" rel="tooltip" title="存储设备名称: 166.111.131.144:/few/fe<br>状态: 在线" data-html="true">
                                        <i class="fa fa-database text-success"></i>块名称
                                    </a>
                                    <a class="btn btn-app" rel="tooltip" title="存储设备名称: 166.111.131.144:/few/fe<br>状态: 在线" data-html="true">
                                        <i class="fa fa-database text-success"></i>块名称
                                    </a>
                                    <a class="btn btn-app" rel="tooltip" title="存储设备名称: 166.111.131.144:/few/fe<br>状态: 在线" data-html="true">
                                        <i class="fa fa-database text-success"></i>块名称
                                    </a>
                                    <a class="btn btn-app" rel="tooltip" title="存储设备名称: 166.111.131.144:/few/fe<br>状态: 在线" data-html="true">
                                        <i class="fa fa-database text-success"></i>块名称
                                    </a>
                                    <a class="btn btn-app" rel="tooltip" title="存储设备名称: 166.111.131.144:/few/fe<br>状态: 在线" data-html="true">
                                        <i class="fa fa-database text-success"></i>块名称
                                    </a>
                                    <a class="btn btn-app" rel="tooltip" title="存储设备名称: 166.111.131.144:/few/fe<br>状态: 在线" data-html="true">
                                        <i class="fa fa-database text-success"></i>块名称
                                    </a>
                                    <a class="btn btn-app" rel="tooltip" title="存储设备名称: 166.111.131.144:/few/fe<br>状态: 在线" data-html="true">
                                        <i class="fa fa-database text-success"></i>块名称
                                    </a>
                                    <a class="btn btn-app" rel="tooltip" title="存储设备名称: 166.111.131.144:/few/fe<br>状态: 在线" data-html="true">
                                        <i class="fa fa-database text-success"></i>块名称
                                    </a>
                                    <a class="btn btn-app" rel="tooltip" title="存储设备名称: 166.111.131.144:/few/fe<br>状态: 在线" data-html="true">
                                        <i class="fa fa-database text-success"></i>块名称
                                    </a>
                                </div>
                                <!-- /.box-body -->
                            </div>
                        </div>
                        <div class="row">
                            <div class="box box-primary">
                                <div class="box-header">
                                    <i class="ion ion-clipboard"></i>

                                    <h3 class="box-title">快照</h3>
                                </div>
                                <div class="box-body">
                                    <table data-toggle="table" id="snapshot" data-unique-id="snapshotName">
                                        <thead>
                                        <tr>
                                            <th data-align="center" data-field="snapshotName">快照名称</th>
                                            <th data-align="center" data-field="createTime">创建时间</th>
                                            <th data-align="center" data-field="snapshotOp">操作</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td>快照1</td>
                                            <td>2016-04-23 20:00:00</td>
                                            <td>
                                                <button type="button" class="btn btn-success btn-sm" style="margin-right: 10px"><i class="fa fa-reply"></i></button>
                                                <button type="button" class="btn btn-danger btn-sm" style="margin-left: 10px"><i class="fa fa-times"></i></button>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <!-- /.box-body -->
                                <div class="box-footer clearfix no-border">
                                    <button type="button" class="btn btn-default pull-right"><i class="fa fa-plus"></i>添加快照</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-2"></div>
        </div>
        <div class="tab-pane" id="sysM" style="color: black">

            <div class="row">
                <div class="col-md-2"></div>
                <div class="col-md-8">
                    <div class="box" id = "serversList">
                        <div class="box-header with-border">
                            <h3 class="box-title">集群机器信息</h3>

                        </div>

                    </div>

                </div>

            </div>
        </div>
        <div class="tab-pane" id="monitorM" style="color: black">
            <div class = "row">
                <div class ="col-md-2"></div>
                <div class="col-md-8">
			<div class="box" id="ServersMoni">
			    
			</div>

                </div>
            </div>
        </div>
        <div class="tab-pane" id="help" style="color: black">
            <h1>帮助</h1>
        </div>
    </div>
</div>

<div class="modal fade modal-danger" id="removeConfirmM">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">危险操作</h4>
            </div>
            <div class="modal-body">
                <p>删除存储可能造成数据丢失!</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline pull-left" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-outline" id="removeConfirm">确认</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<div class="modal fade modal-default" id="addVolumeM">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">添加存储卷</h4>
            </div>
            <div class="modal-body">
                <form role="form" id="volumeCForm" data-toggle="validator">
                    <div class="box-body">
                        <div class="form-group">
                            <label for="cVolumeName">存储卷名称</label>
                            <input type="text" class="form-control" id="cVolumeName" placeholder="存储卷名称" required>
                        </div>
                        <div class="form-group">
                            <label for="vCapacity">容量</label>
                            <input id="vCapacity" type="text" name="vCapacity" value="" >
                        </div>
                        <div class="form-group">
                            <label for="Redundancy">冗余比</label>
                            <select id="Redundancy" class="form-control">
                                <option value="20">20%</option>
                                <option value="30">30%</option>
                                <option value="60">60%</option>
                            </select>
                        </div>
                    </div>
                    <!-- /.box-body -->

                    <div class="box-footer">
                        <button id="subVolumeC" type="submit" class="btn btn-primary">创建</button>
                    </div>
                </form>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline pull-left" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-outline" id="addConfirm">确认</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>



{% endblock %}

{% block scripts %}
{{super() }}
<!-- FLOT CHARTS -->
<script src="{{url_for('.static',filename='plugins/flot/jquery.flot.min.js')}}"></script>
<!-- FLOT RESIZE PLUGIN - allows the chart to redraw when the window is resized -->
<script src="{{url_for('.static',filename='plugins/flot/jquery.flot.resize.min.js')}}"></script>
<!-- FLOT PIE PLUGIN - also used to draw donut charts -->
<script src="{{url_for('.static',filename='plugins/flot/jquery.flot.pie.min.js')}}"></script>
<!-- FLOT CATEGORIES PLUGIN - Used to draw bar charts -->
<script src="{{url_for('.static',filename='plugins/flot/jquery.flot.categories.min.js')}}"></script>

<script type="text/javascript" src="{{url_for('.static',filename='plugins/chartjs/highcharts.js')}}"></script>
<script type=text/javascript>
    $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
</script>
<script>
    var table = $('#volumeList');
    var vCapacity;
    var getCData = function(data){
        vCapacity = data.from;
    };
    var volumeData = [
        {
            volumeName : "test1",
            status : "running",
            capacity : "20TB",
            NFS : true,
            Samba : true,
            iSCSI : true,
            Swift : true,
            free : 3,
            use : 17,
            read : [2,2,2,2,3,3,3,3,2,2],
            write : [3,3,3,3,3,4,3,3,3,3],
            NFSInfo : {address: "166.111.131.144:/data1", username: "用户名", password: "密码"},
            sambaInfo : {address: "166.111.131.144:/data1", username: "用户名", password: "密码"},
            iSCSIInfo : {address: "166.111.131.144:/data1", username: "用户名", password: "密码"},
            SwiftInfo : {address: "166.111.131.144:/data1", username: "用户名", password: "密码"},
            usage : 25,
            bricks : [{name: "166.111.131.144:/bricks1", online : true},{name : "166.111.131.144:/bricks2", online : false}],
            snapshot : [{name : "snapshot1", time : "2016-04-10"},{name : "snapshot2", time : "2016-04-13"}]
        },
        {
            volumeName : "test2",
            status : "running",
            capacity : "10TB",
            NFS : true,
            Samba : true,
            iSCSI : true,
            Swift : true,
            free : 3,
            use : 7,
            read : [2,2,2,2,3,3,3,3,2,2],
            write : [3,3,3,3,3,4,3,3,3,3],
            NFSInfo : {address: "166.111.131.144:/data1", username: "用户名", password: "密码"},
            sambaInfo : {address: "166.111.131.144:/data1", username: "用户名", password: "密码"},
            iSCSIInfo : {address: "166.111.131.144:/data1", username: "用户名", password: "密码"},
            SwiftInfo : {address: "166.111.131.144:/data1", username: "用户名", password: "密码"},
            usage : 50,
            bricks : [{name: "166.111.131.144:/bricks1", online : true},{name : "166.111.131.144:/bricks2", online : false}],
            snapshot : [{name : "snapshot1", time : "2016-04-10"},{name : "snapshot2", time : "2016-04-13"}]
        },
        {
            volumeName : "test3",
            status : "stop",
            capacity : "10TB",
            NFS : false,
            Samba : false,
            iSCSI : false,
            Swift : false,
            free : 5,
            use : 5,
            read : [2,2,2,2,3,3,3,3,2,2],
            write : [3,3,3,3,3,4,3,3,3,3],
            NFSInfo : {address: "166.111.131.144:/data1", username: "用户名", password: "密码"},
            sambaInfo : {address: "166.111.131.144:/data1", username: "用户名", password: "密码"},
            iSCSIInfo : {address: "166.111.131.144:/data1", username: "用户名", password: "密码"},
            SwiftInfo : {address: "166.111.131.144:/data1", username: "用户名", password: "密码"},
            usage : 45,
            bricks : [{name: "166.111.131.144:/bricks1", online : true},{name : "166.111.131.144:/bricks2", online : false}],
            snapshot : [{name : "snapshot1", time : "2016-04-10"},{name : "snapshot2", time : "2016-04-13"}]
        }
    ];

    var serverslist= $('#serversList');
    var servers = [
        {
            serverId: "tfs00",
            serverStatus: "running",
            disks: [
                {
                    diskId:"disk1",
                    diskStatus:"health"
                },
                {
                    diskId:"disk2",
                    diskStatus:"unhealth"
                }
            ]
        },
        {
            serverId: "tfs01",
            serverStatus: "stop",
            disks: [
                {
                    diskId:"disk1",
                    diskStatus:"health"
                },
                {
                    diskId:"disk2",
                    diskStatus:"unhealth"
                }
            ]
        },
        {
            serverId: "tfs02",
            serverStatus:"running",
            disks: [
                {
                    diskId:"disk1",
                    diskStatus:"health"
                },
                {
                    diskId:"disk2",
                    diskStatus:"unhealth"
                }
            ]
        },
        {
            serverId: "tfs03",
            serverStatus:"running",
            disks: [
                {
                    diskId:"disk1",
                    diskStatus:"health"
                },
                {
                    diskId:"disk2",
                    diskStatus:"unhealth"
                }
            ]
        },
        {
            serverId: "tfs04",
            serverStatus:"running",
            disks: [
                {
                    diskId:"disk1",
                    diskStatus:"health"
                },
                {
                    diskId:"disk2",
                    diskStatus:"unhealth"
                }
            ]
        },
        {
            serverId: "tfs05",
            serverStatus:"running",
            disks: [
                {
                    diskId:"disk1",
                    diskStatus:"health"
                },
                {
                    diskId:"disk2",
                    diskStatus:"unhealth"
                }
            ]
        },
        {
            serverId: "tfs06",
            serverStatus:"running",
            disks: [
                {
                    diskId:"disk1",
                    diskStatus:"health"
                },
                {
                    diskId:"disk2",
                    diskStatus:"unhealth"
                }
            ]
        },
        {
            serverId:"tfs07",
            serverStatus: "stop",
            disks: [
                {
                    diskId:"disk1",
                    diskStatus:"health"
                },
                {
                    diskId:"disk2",
                    diskStatus:"unhealth"
                }
            ]
        },
        {
            serverId:"tfs08",
            serverStatus:"stop",
            disks: [
                {
                    diskId:"disk1",
                    diskStatus:"health"
                },
                {
                    diskId:"disk2",
                    diskStatus:"unhealth"
                }
            ]
        }
    ];

    var clusterinfo = getClusterInfo();

    //alert("Data:" + clusterinfo["cluster"][0]["hostname"]);

    var serversinfo = clusterinfo["cluster"];

    if (serversinfo[0]["hostname"] == '127.0.0.1'){
        serversinfo[0]["hostname"] = "localhost";
    }
    for(i=0; i < serversinfo[0]["cpus"].length; i++){
        serversinfo[0]["cpus"][i]["name"] = 'cpu'+i;
    }



    var globalVolumeData = {};
    //初始化全局数据,name->status
    for (i = 0; i < volumeData.length; i++){
        var tmpName = volumeData[i]["volumeName"];
        globalVolumeData[tmpName] = volumeData[i]["status"];
    }
    jQuery(document).ready(function ($) {
        $("[rel='tooltip']").tooltip();
        //初始化客户端,后期移到动态创建里面
        var nfsClient = $('#nfsClient');
        nfsClient.change(function() {
            if (nfsClient.prop("checked")){
                alert("checked");
            } else {
                alert("unchecked");//-------------------------------------------------to do
            }
        });
        //创建volume--------------------------------
        $("#volumeCForm").submit(function( event ) {
            //创建volume
            event.preventDefault();
            var volume_name = $('#cVolumeName').val();
            var volume_capacity = vCapacity;
            var Redundancy = $('#Redundancy').val();

            $.getJSON($SCRIPT_ROOT + '/volume/create', {
                volumeName : volume_name,
                volumeCapacity : volume_capacity,
                redundancy : Redundancy
            }, function (data) {
                var result = data["result"];
                if (result == "success"){
                    //判断是否为唯一一个volume
                    if (Object.keys(globalVolumeData).length == 0){
                        $("#noVolume").css('display','none');
                    }
                    globalVolumeData[volume_name] = "stop";
                    //添加新的tab和content
                    var newVolumeData = data["msg"]

                }
            });

            $("#addVolumeM").modal("hide");
        });
        $("#vCapacity").ionRangeSlider({
            min: 1,
            max: 20,
            from: 3,
            postfix: "TB",
            onStart : function(data){
                getCData(data);
            },
            onChange : getCData,
            onFinish : getCData

        });
        $("#tabs").tab();
        $('.nav-stacked').click(function (e) {
            var target = $(e.target).attr("href");
            //判断状态确定删除键是否可以使用
            //var volumeID = $('.nav-stacked .active').text();
            var volumeID = target.replace("#tabContent","");
            if (globalVolumeData[volumeID] == "running"){
                $('#removeVolume').prop("disabled", true);
            } else {
                $('#removeVolume').prop("disabled", false);
            }
            var rwSpeedIDt = '#' + volumeID + 'rwSpeed';
            setTimeout(function(){$(rwSpeedIDt).highcharts().reflow();}, 1);
        });
        $('.nav-tabs').click(function (e) {
            var target = $(e.target).attr("href");
            //判断状态确定删除键是否可以使用
            //var volumeID = $('.nav-stacked .active').text();
            var tabPage = target.replace("#","");
            if (tabPage == "volumeM"){
                var currentVolume = $('.nav-stacked .active').text();
                setTimeout(function(){$("#" + currentVolume + "rwSpeed").highcharts().reflow();}, 1);
            }
            if (tabPage == "monitorM"){

                setTimeout(function (){
                    for (var i = 0; i < serversinfo.length; i++){
                        $("#CPU"+serversinfo[i]["hostname"]).highcharts().reflow();
                    }

                },1);

                setTimeout(function (){
                    for (var i = 0; i < serversinfo.length; i++){
                        $("#Mem"+serversinfo[i]["hostname"]).highcharts().reflow();
                    }

                },1);


            }
        });
        $("#removeConfirm").click(function(){
            //alert("当前存储卷!" + $('.nav-stacked .active').text());
            //删除当前的volume
            var volumeID = $('.nav-stacked .active').text();
            $.getJSON($SCRIPT_ROOT + '/volume/remove', {
                volumeName: volumeID
            }, function (data) {
                var result = data["result"];
                if (result == "success"){
                    //删除成功
                    alert("删除成功!");
                    delete globalVolumeData[volumeID];
                    //删除系统概要表格列
                    table.bootstrapTable('removeByUniqueId', volumeID);
                    //删除nva tab以及对应的content
                    var volumeTab = $('#tabList' + volumeID);
                    var volumeContent = $('#tabContent' + volumeID);
                    volumeTab.remove();
                    volumeContent.remove();
                    if (Object.keys(globalVolumeData).length > 0){
                        //显示第一个为active
                        //alert("set active");
                        var firstVolume = Object.keys(globalVolumeData)[0];
                        $('.nav-stacked a[href="#tabContent' + firstVolume + '"]').tab('show');
                    } else {
                        $("#noVolume").css('display','block');
                        $('#removeVolume').prop("disabled", true);
                    }
                } else {
                    //删除失败
                    alert("删除失败" + result);
                }
            });
            $("#removeConfirmM").modal("hide");
        });
    });




    $(function () {
        /*----------------------------------系统概要tab-----------------------------------*/
        /*添加数据到volumeList*/
        var formatData = [];
        for (var i = 0; i < volumeData.length; i++){
            var tmp = {};
            tmp["volumeName"] = volumeData[i]["volumeName"];
            if (volumeData[i]["status"] == "running"){
                tmp["status"] = "<span class=\"label label-success\">运行中</span>";
            } else{
                tmp["status"] = "<span class=\"label label-danger\">停止</span>";
            }
            tmp["capacity"] = volumeData[i]["capacity"];
            if (volumeData[i]["NFS"]){
                tmp["NFS"] = "<span style='color:green'><i class='fa fa-fw fa-circle'></i></span>";
            } else{
                tmp["NFS"] = "<span style='color:red'><i class='fa fa-fw fa-circle-o'></i></span>";
            }
            if (volumeData[i]["Samba"]){
                tmp["Samba"] = "<span style='color:green'><i class='fa fa-fw fa-circle'></i></span>";
            } else{
                tmp["Samba"] = "<span style='color:red'><i class='fa fa-fw fa-circle-o'></i></span>";
            }
            if (volumeData[i]["iSCSI"]){
                tmp["iSCSI"] = "<span style='color:green'><i class='fa fa-fw fa-circle'></i></span>";
            } else{
                tmp["iSCSI"] = "<span style='color:red'><i class='fa fa-fw fa-circle-o'></i></span>";
            }
            if (volumeData[i]["Swift"]){
                tmp["Swift"] = "<span style='color:green'><i class='fa fa-fw fa-circle'></i></span>";
            } else{
                tmp["Swift"] = "<span style='color:red'><i class='fa fa-fw fa-circle-o'></i></span>";
            }
            formatData.push(tmp);
        }
        table.bootstrapTable('append', formatData);




        var donutData = [
            {label: "已使用", data: 20, color: "#0073b7"},
            {label: "未使用", data: 80, color: "#00c0ef"}
        ];
        $.plot("#sysUsage", donutData, {
            series: {
                pie: {
                    show: true,
                    radius: 1,
                    innerRadius: 0.5,
                    label: {
                        show: true,
                        radius: 2 / 3,
                        formatter: labelFormatter,
                        threshold: 0.1
                    }

                }
            },
            legend: {
                show: false
            }
        });
        /*------test------*/
        $.plot("#volumeUsage", donutData, {
            series: {
                pie: {
                    show: true,
                    radius: 1,
                    innerRadius: 0.4,
                    label: {
                        show: true,
                        radius: 2 / 3,
                        formatter: labelFormatter,
                        threshold: 0.1
                    }

                }
            },
            legend: {
                show: false
            }
        });
        /*---------------*/
        /*------------------------------------------存储卷管理tab------------------------*/
        var volumeTabs = $('#volumeTabs');
        var volumeContent = $('#volumeContent');
        var removeButton = $('#removeVolume');

        for (i = 0; i < volumeData.length; i++){
            if (i == 0){
                $("#noVolume").css('display','none');
            }
            volumeTabs.append(volumeTabFormat(volumeData[i]["volumeName"], i));
            volumeContent.append(volumeContentFormat(volumeData[i], i));
            //初始化饼图
            var volumeUsageID = '#' + volumeData[i]["volumeName"] + 'Usage';
            var usage = volumeData[i]["usage"];
            var usageData = [
                {label: "已使用", data: usage, color: "#0073b7"},
                {label: "未使用", data: 100 - usage, color: "#00c0ef"}
            ];
            $.plot(volumeUsageID, usageData, {
                series: {
                    pie: {
                        show: true,
                        radius: 1,
                        innerRadius: 0.4,
                        label: {
                            show: true,
                            radius: 2 / 3,
                            formatter: labelFormatter,
                            threshold: 0.1
                        }

                    }
                },
                legend: {
                    show: false
                }
            });
            //初始化曲线图
            var rwSpeedID = '#' + volumeData[i]["volumeName"] + 'rwSpeed';
            $(rwSpeedID).highcharts({
                credits: {
                    enabled: false
                },
                chart: {
                    type: 'line',
                    animation: false, // don't animate in old IE
                    events: {
                        load: function (event) {
                            var series = this.series[0];
                            var series1 = this.series[1];
                            setInterval(function () {
                                var x = (new Date()).getTime(), // current time
                                        y = Math.random();//y get from background
                                series.addPoint([x, y], true, true);
                                series1.addPoint([x, Math.random()], true, true);
                            }, 1000);
                        }
                    }
                },
                xAxis: {
                    type: 'datetime',
                    tickPixelInterval: 150,
                    minPadding: 0,
                    maxPadding: 0
                },
                yAxis: {
                    title: {
                        text: 'MB/s'
                    },
                    plotLines: [{
                        value: 0,
                        width: 1,
                        color: '#808080'
                    }]
                },
                tooltip: {
                    formatter: function () {
                        return '<b>' + this.series.name + '</b><br/>' +
                                Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
                                Highcharts.numberFormat(this.y, 2);
                    },
                    crosshairs: true
                },
                plotOptions: {
                    series: {
                        dataLabels: {
                            allowOverlap: true
                        }
                    }
                },
                title : {
                    text : ""
                },
                legend: {
                    enabled: true
                },
                exporting: {
                    enabled: false
                },
                series: [{
                    name: '读',
                    data: (function () {
                        var len = volumeData[i]["read"].length;
                        // generate an array of random data
                        var data = [],
                                time = (new Date()).getTime(),
                                j = -len;

                        for (; j < 0; j += 1) {
                            data.push({
                                x: time + j * 1000,
                                y: volumeData[i]["read"][len + j]
                            });
                        }
                        //console.log(volumeData[i]["write"].length);
                        return data;
                    }())
                }, {
                    name: '写',
                    data: (function () {
                        var len = volumeData[i]["write"].length;
                        // generate an array of random data
                        var data = [],
                                time = (new Date()).getTime(),
                                j = -len;

                        for (; j < 0; j += 1) {
                            data.push({
                                x: time + j * 1000,
                                y: volumeData[i]["write"][len + j]
                            });
                        }
                        //console.log(volumeData[i]["write"].length);
                        return data;
                    }()),
                    color : '#6FDB4B'
                }]
            });
            //初始化clinetTable
            var clientTableID = '#' + volumeData[i]["volumeName"] + "ClientTable";
            console.log(clientTableID);
            var $clientTable = $(clientTableID);
            var clientData = [];
            var tmpClientData = {};
            //NFS
            if (volumeData[i]["NFS"]){
                var nfsData = volumeData[i]["NFSInfo"];
                //nfs开启
                tmpClientData["ck"] = '<input id="' + volumeData[i]["volumeName"] +'nfsClient" type="checkbox" checked data-toggle="toggle" data-on="On" data-off="Off" data-onstyle="success" data-offstyle="danger" data-size="mini">';
                tmpClientData["client"] = "NFS";
                tmpClientData["address"] = nfsData["address"];
                tmpClientData["username"] = nfsData["username"];
                tmpClientData["password"] = nfsData["password"];
            } else {
                tmpClientData["ck"] = '<input id="' + volumeData[i]["volumeName"] +'nfsClient" type="checkbox" unchecked data-toggle="toggle" data-on="On" data-off="Off" data-onstyle="success" data-offstyle="danger" data-size="mini">';
                tmpClientData["client"] = "NFS";
                tmpClientData["address"] = "--";
                tmpClientData["username"] = "--";
                tmpClientData["password"] = "--";
            }
            clientData.push(tmpClientData);
            tmpClientData = {};
            //Samba
            if (volumeData[i]["Samba"]){
                var sambaData = volumeData[i]["sambaInfo"];
                //nfs开启
                tmpClientData["ck"] = '<input id="' + volumeData[i]["volumeName"] +'sambaCient" type="checkbox" checked data-toggle="toggle" data-on="On" data-off="Off" data-onstyle="success" data-offstyle="danger" data-size="mini">';
                tmpClientData["client"] = "Samba";
                tmpClientData["address"] = sambaData["address"];
                tmpClientData["username"] = sambaData["username"];
                tmpClientData["password"] = sambaData["password"];
            } else {
                tmpClientData["ck"] = '<input id="' + volumeData[i]["volumeName"] +'sambaCient" type="checkbox" unchecked data-toggle="toggle" data-on="On" data-off="Off" data-onstyle="success" data-offstyle="danger" data-size="mini">';
                tmpClientData["client"] = "Samba";
                tmpClientData["address"] = "--";
                tmpClientData["username"] = "--";
                tmpClientData["password"] = "--";
            }
            clientData.push(tmpClientData);
            tmpClientData = {};
            //iSCSI
            if (volumeData[i]["iSCSI"]){
                var iscsiData = volumeData[i]["iSCSIInfo"];
                //nfs开启
                tmpClientData["ck"] = '<input id="' + volumeData[i]["volumeName"] +'iscsiClient" type="checkbox" checked data-toggle="toggle" data-on="On" data-off="Off" data-onstyle="success" data-offstyle="danger" data-size="mini">';
                tmpClientData["client"] = "iSCSI";
                tmpClientData["address"] = iscsiData["address"];
                tmpClientData["username"] = iscsiData["username"];
                tmpClientData["password"] = iscsiData["password"];
            } else {
                tmpClientData["ck"] = '<input id="' + volumeData[i]["volumeName"] +'iscsiClient" type="checkbox" unchecked data-toggle="toggle" data-on="On" data-off="Off" data-onstyle="success" data-offstyle="danger" data-size="mini">';
                tmpClientData["client"] = "iSCSI";
                tmpClientData["address"] = "--";
                tmpClientData["username"] = "--";
                tmpClientData["password"] = "--";
            }
            clientData.push(tmpClientData);
            tmpClientData = {};
            //swift
            if (volumeData[i]["Swift"]){
                var swiftData = volumeData[i]["SwiftInfo"];
                //nfs开启
                tmpClientData["ck"] = "<input id=\" " + volumeData[i]["volumeName"] +"SwiftClient\" type=\"checkbox\" checked data-toggle=\"toggle\" data-on=\"On\" data-off=\"Off\" data-onstyle=\"success\" data-offstyle=\"danger\" data-size=\"mini\">";
                tmpClientData["client"] = "Swift";
                tmpClientData["address"] = swiftData["address"];
                tmpClientData["username"] = swiftData["username"];
                tmpClientData["password"] = swiftData["password"];
            } else {
                tmpClientData["ck"] = "<input id=\" " + volumeData[i]["volumeName"] +"SwiftClient\" type=\"checkbox\" unchecked data-toggle=\"toggle\" data-on=\"On\" data-off=\"Off\" data-onstyle=\"success\" data-offstyle=\"danger\" data-size=\"mini\">";
                tmpClientData["client"] = "Swift";
                tmpClientData["address"] = "--";
                tmpClientData["username"] = "--";
                tmpClientData["password"] = "--";
            }
            clientData.push(tmpClientData);
            //console.log(clientData);
            //$clientTable.bootstrapTable('append', clientData);
            if (i == 0){
                console.log("don1")
                $('#table_test').bootstrapTable('append', clientData);
            }
            console.log("done2");

            if (i == 0 && volumeData[i]["status"] == "stop"){
                removeButton.prop("disabled", false);
            }
        }
        /*--------------------------tabcontent-----------------*/

        Highcharts.setOptions({
            global: {
                useUTC: false
            }
        });

        $('#rwSpeed').highcharts({
            credits: {
                enabled: false
            },
            chart: {
                type: 'line',
                animation: false, // don't animate in old IE
                events: {
                    load: function (event) {
                        var series = this.series[0];
                        var series1 = this.series[1];
                        setInterval(function () {
                            var x = (new Date()).getTime(), // current time
                                    y = Math.random();//y get from background
                            series.addPoint([x, y], true, true);
                            series1.addPoint([x, Math.random()], true, true);
                        }, 1000);
                    }
                }
            },
            xAxis: {
                type: 'datetime',
                tickPixelInterval: 150,
                minPadding: 0,
                maxPadding: 0
            },
            yAxis: {
                title: {
                    text: 'MB/s'
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                formatter: function () {
                    return '<b>' + this.series.name + '</b><br/>' +
                            Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
                            Highcharts.numberFormat(this.y, 2);
                },
                crosshairs: true
            },
            plotOptions: {
                series: {
                    dataLabels: {
                        allowOverlap: true
                    }
                }
            },
            title : {
                text : ""
            },
            legend: {
                enabled: true
            },
            exporting: {
                enabled: false
            },
            series: [{
                name: '读',
                data: (function () {
                    // generate an array of random data
                    var data = [],
                            time = (new Date()).getTime(),
                            i;

                    for (i = -19; i <= 0; i += 1) {
                        data.push({
                            x: time + i * 1000,
                            y: Math.random()
                        });
                    }
                    return data;
                }())
            }, {
                name: '写',
                data: (function () {
                    // generate an array of random data
                    var data = [],
                            time = (new Date()).getTime(),
                            i;

                    for (i = -19; i <= 0; i += 1) {
                        data.push({
                            x: time + i * 1000,
                            y: Math.random()
                        });
                    }
                    return data;
                }()),
                color : '#6FDB4B'
            }]
        });

               /*    System Manager table-------------------------*/
        var count = 0;
        for (count = 0; count < servers.length; count++){
            serverslist.append(serversListFormat(servers[count]["serverId"], count));
        }
        for (count = 0; count < servers.length; count++){
            for (var i = 0; i < servers[count]["disks"].length; i++){
                //alert("done");
                var serverid = '#diskinfo' + servers[count]["serverId"];
                var disklist = $(serverid);
                //diskContentFormat(servers[count]["disks"][i]["diskId"], i, count)
                disklist.append(diskContentFormat(servers[count]["disks"][i]["diskId"], i, count));
            }
        }


        /*　System Moniter ---------------------------------*/





        var SystemMoni = $('#ServersMoni');

        for (count = 0; count < serversinfo.length; count++){
            SystemMoni.append(monitorinfoFormat(serversinfo[count]["hostname"], count));
           // SystemMoni.append(monitorinfoFormat("localhost", count));


            Highcharts.setOptions({
                global: {
                    useUTC: false
                }
            });
            var CPUid = '#CPU' + serversinfo[count]["hostname"];
            //var CPUid = '#CPU' + 'localhost';
            //var test = createSeries(0);
            //alert(test.length);
            //alert(test[0]["name"]);
           // alert(CPUid);
           // alert(getSeries(count) +"hello");
            $(CPUid).highcharts( {
                credits: {
                    enabled: false
                },
                chart: {
                   // renderTo: 'container',
                    type: 'spline',
                    animation: false, // don't animate in old IE
                    events: {
                        load: function (event) {

                            var series = this.series;
<<<<<<< HEAD

=======
>>>>>>> c4d251c4fcf76c6e5912aa8fb531e98c97c02c91
                            var cnt = count;
                            setInterval(function ( ) {
                                var x = (new Date()).getTime();
                                 // current time
                            /*    for(var i = 0; i < serversinfo[count]["cpus"].length; i++)
                                {
                                    var x = (new Date()).getTime();
                                    var y = Math.random();//y get from background
                                    series[i].addPoint([x, y],true,true);
                                }*/
                               var url = $SCRIPT_ROOT + '/monitor/info';
                                $.getJSON(url, null, function (data) {
                                    for (var i = 0; i < series.length; i++)
                                    {
                                        series[i].addPoint([x, parseFloat(data["cluster"][cnt]["cpus"][i]["usage"][19])], true, true);
                                    }
                                });

<<<<<<< HEAD
=======

>>>>>>> c4d251c4fcf76c6e5912aa8fb531e98c97c02c91
                            }, 1000);
                        }

                    }
                },
                xAxis: {
                    type: 'datetime',
                    tickPixelInterval: 150,
                    minPadding: 0,
                    maxPadding: 0
                },
                yAxis: {
                    title: {
                        text: 'CPU使用率(%)'
                    },
                    plotLines: [{
                        value: 0,
                        width: 2,
                        color: '#808080'
                    }]
                },
                tooltip: {
                    formatter: function () {
                        return '<b>' + this.series.name + '</b><br/>' +
                                Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
                                Highcharts.numberFormat(this.y, 2);
                    },
                    crosshairs: true
                },
                plotOptions: {
                    /*series: {
                        dataLabels: {
                            allowOverlap: true
                        }
                    }*/
                   /* spline: {
                            lineWidth: 1.5,
                            fillOpacity: 0.1,
                             marker: {
                                enabled: false,
                                states: {
                                    hover: {
                                        enabled: true,
                                        radius: 2
                                    }
                                }
                            },
                            shadow: false
                    }*/

                },
                title : {
                    text : ""
                },
                legend: {
                    enabled: true
                },
                exporting: {
                    enabled: false
                },
<<<<<<< HEAD
                series : createCPUSeries(count)

            });


            var memId = '#Mem' + serversinfo[count]["hostname"];
            //var CPUid = '#CPU' + 'localhost';
            //var test = createSeries(0);
            //alert(test.length);
            //alert(test[0]["name"]);
           // alert(CPUid);
           // alert(getSeries(count) +"hello");
            $(memId).highcharts( {
                credits: {
                    enabled: false
                },
                chart: {
                   // renderTo: 'container',
                    type: 'spline',
                    animation: false, // don't animate in old IE
                    events: {
                        load: function (event) {

                            var series = this.series;

                            var cnt = count;
                            setInterval(function ( ) {
                                var x = (new Date()).getTime();
                                 // current time
                            /*    for(var i = 0; i < serversinfo[count]["cpus"].length; i++)
                                {
                                    var x = (new Date()).getTime();
                                    var y = Math.random();//y get from background
                                    series[i].addPoint([x, y],true,true);
                                }*/
                               var url = $SCRIPT_ROOT + '/monitor/info';
                                $.getJSON(url, null, function (data) {

                                    series[0].addPoint([x, parseFloat(data["cluster"][cnt]["memory"]["usage"][19])], true, true);

                                });

                            }, 1000);
                        }

                    }
                },
                xAxis: {
                    type: 'datetime',
                    tickPixelInterval: 150,
                    minPadding: 0,
                    maxPadding: 0
                },
                yAxis: {
                    title: {
                        text: '内存使用率(%, '+ getMemsize(count)+'G)'
                    },
                    plotLines: [{
                        value: 0,
                        width: 2,
                        color: '#808080'
                    }]
                },
                tooltip: {
                    formatter: function () {
                        return '<b>' + this.series.name + '</b><br/>' +
                                Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
                                Highcharts.numberFormat(this.y, 3);
                    },
                    crosshairs: true
                },
                plotOptions: {
                    series: {
                        dataLabels: {
                            allowOverlap: true
                        }
                    }
                },
                title : {
                    text : ""
                },
                legend: {
                    enabled: true
                },
                exporting: {
                    enabled: false
                },
                series : createMemSeries(count)

=======
                series : createSeries(count)

>>>>>>> c4d251c4fcf76c6e5912aa8fb531e98c97c02c91
            });




        }
		
		

    });

    function getMemsize(serverId){
        return serversinfo[serverId]["memory"]["size"];
    }

    function createMemSeries(serverId) {
        var series = new Array();
        var time = (new Date()).getTime();


        var data = function () {
            var data = [],  i;
            for (i = -19; i <= 0; i++){
                data.push({
                    "x": time + i * 1000,
                    "y": parseFloat(serversinfo[serverId]["memory"]["usage"][i + 19])
                });
            }
            return data;
        }();
        series.push({
            "name": "memory",
            "data": data

        });
          //  alert(cpuId);


       // alert(serversinfo[serverId]["cpus"][7]["name"] + "hello");
       // alert(series);
        //alert(series.length);
        return series;

    }


    function  getSeries(serverId) {
        return serversinfo[serverId]["cpus"].length;
    }


    function createCPUSeries (serverId) {

        var series = new Array();
        var time = (new Date()).getTime();
        for (var cpuId = 0; cpuId < serversinfo[serverId]["cpus"].length; cpuId++){

            var data = function () {
                var data = [],  i;
                for (i = -19; i <= 0; i++){
                    data.push({
                        "x": time + i * 1000,
                        "y": parseInt(serversinfo[serverId]["cpus"][cpuId]["usage"][i + 19])
                    });
                }
                return data;
            }();
            series.push({
                "name": serversinfo[serverId]["cpus"][cpuId]["name"],
                "data": data

            });
          //  alert(cpuId);

        }
       // alert(serversinfo[serverId]["cpus"][7]["name"] + "hello");
       // alert(series);
        //alert(series.length);
        return series;
    }

    function getClusterInfo() {

        var url = $SCRIPT_ROOT + '/monitor/info';

        var clusterinfomat={
            cluster: [{
                hostname:"tfs00"
            }
            ]
        };
        $.ajaxSetup({async:false});
        $.getJSON(url, null, function (data) {

           // alert(data["cluster"][0]["hostname"]);
            clusterinfomat = data;
        });
        return clusterinfomat;
    }


    function monitorinfoFormat(serverId, i) {
        return '<div class="col-md-12">'+
                '<div class= "box-header with-border">' +
                    '<h3 class ="box-title" id="serverid">机器名称：' + serverId + '</h3>' +
                '</div>' +
                '<div class= "col-md-6">' +
                    '<div class="box box-primary">' +
                            '<div class="box-header with-border">' +
                                    '<i class="fa fa-bar-chart-o"></i>' +
                            '<h3 class="box-title">CPU使用率</h3>' +
                                '</div>' +
                                    '<div class="box-body" id="rwCPU'+ serverId+ '">' +
                                            '<div id="CPU'+ serverId+ '" style="height: 180px; width: 100%"></div>' +
                                    '</div>' +
                            '</div>' +
                '</div>'+

                '<div class= "col-md-6">' +
                    '<div class="box box-primary">' +
                            '<div class="box-header with-border">' +
                                    '<i class="fa fa-bar-chart-o"></i>' +
                            '<h3 class="box-title">内存使用率</h3>' +
                                '</div>' +
                                    '<div class="box-body" id="rwMem'+ serverId+ '">' +
                                            '<div id="Mem' + serverId + '" style="height: 180px; width: 100%"></div>' +
                                    '</div>' +
                            '</div>' +
                '</div>'+
                '<div class= "col-md-6">' +
                    '<div class="box box-primary">' +
                            '<div class="box-header with-border">' +
                                    '<i class="fa fa-bar-chart-o"></i>' +
                            '<h3 class="box-title">网络I/O</h3>' +
                                '</div>' +
                                    '<div class="box-body" id="rwNet'+ serverId+ '">' +
                                            '<div id="Net' + serverId + '" style="height: 180px; width:100%"></div>' +
                                    '</div>' +
                            '</div>' +
                '</div>'+
                '<div class= "col-md-6">' +
                    '<div class="box box-primary">' +
                            '<div class="box-header with-border">' +
                                    '<i class="fa fa-bar-chart-o"></i>' +
                            '<h3 class="box-title">磁盘I/O</h3>' +
                                '</div>' +
                                    '<div class="box-body" id="rwNet'+ serverId+ '">' +
                                            '<div id="Iodisk' + serverId + '" style="height: 180px; width: 100%"></div>' +
                                    '</div>' +
                            '</div>' +
                '</div>'+

                '<div class="box box-danger col-md-6">' +
                    '<div class="box-header with-border">' +
                        '<h3 class="box-title">Donut Chart</h3>' +
                        '<div class="box-tools pull-right">' +
                            '<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i> </button>' +
                            '<button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>' +
                        '</div>' +
                    '</div>' +
                    '<div class="box-body chart-responsive">' +
                        '<div class="chart" id="sales-chart" style="height: 300px; position: relative;"></div>' +
                    '</div>' +
                '</div>'+
            '</div>';
    }
    function serversListFormat(serverId, i) {
        if (servers[i]["serverStatus"] == "running"){
            return '<div class="info-box"><span style = "color:green" class="info-box-icon "><i class="fa fa-fw fa-tv" title="服务器名称:'+ serverId+'"></i></span>' +
                        '<div class="info-box-content" style="color: black"> ' +
                            '<span class="info-box-text">'+ serverId + '</span> ' +
                            '<div class="info-box-number" id="diskinfo'+ serverId + '">' +
                                '<button type="button" class="btn btn-primary btn-sm col-md-offset-10 pull-right" id="serverRestart"><i class="fa fa-refresh">立即重启</i></button>'+
                            '</div>' +
                        '</div>'
                    '</div>';
        }else{
            return '<div class="info-box"><span style = "color:darkslategray" class="info-box-icon"><i class="fa fa-fw fa-tv" title="服务器名称:'+ serverId+'"></i></span>  ' +
                        '<div class="info-box-content" style="color: black"> ' +
                            '<span class="info-box-text">'+ serverId + '</span>' +
                            '<div class="info-box-number" id="diskinfo'+ serverId +'">' +
                               '<button type="button" class="btn btn-primary btn-sm col-md-offset-10 pull-right" id="serverRestart"><i class="fa fa-refresh">立即重启</i></button>'+
                            '</div>' +
                        '</div>'
                    '</div>';
        }
    }
    function diskContentFormat(diskId , i, count){
        if (servers[count]["disks"][i]["diskStatus"] == "health") {
           // return '<a class="btn btn-app" rel="tooltip" title="存储设备名称: 166.111.131.144:/few/fe<br>状态: 在线" data-html="true">  <i class="fa fa-database text-success"></i>块名称</a>';
            return ' <i class="fa fa-database text-success" title="磁盘编号:'+ diskId + '"></i>'
        }else{
          //  return '<a class="btn btn-app" rel="tooltip" title="存储设备名称: 166.111.131.144:/few/fe<br>状态: 在线" data-html="true">  <i class="fa fa-database text-danger"></i>块名称</a>';
            return ' <i class="fa fa-database text-danger" title="磁盘编号:'+ diskId + '"></i>'
        }
    }
    function labelFormatter(label, series) {
        return '<div style="font-size:13px; text-align:center; padding:2px; color: #fff; font-weight: 600;">'
                + label
                + "<br>"
                + Math.round(series.percent) + "\%</div>";
    }
    function volumeTabFormat(volumeName, i){
        if (i == 0){
            return '<li role="presentation" id ="tabList' + volumeName + '" class ="active"><a href="#tabContent' + volumeName + '" data-toggle="tab">' + volumeName + '</a></li>';
        }else {
            return '<li role="presentation" id ="tabList' + volumeName + '"><a href="#tabContent' + volumeName + '" data-toggle="tab">' + volumeName + '</a></li>';
        }

    }
    function volumeContentFormat(volumeData, i){
        if (i == 0){
            return '<div id="tabContent' + volumeData["volumeName"] + '" class="tab-pane active">' + contentFirstRow(volumeData) + contentSecondRow(volumeData) + '</div>';
        } else {
            return '<div id="tabContent' + volumeData["volumeName"] + '" class="tab-pane">' + contentFirstRow(volumeData) + contentSecondRow(volumeData) + '</div>';
        }
    }

    function contentFirstRow(volumeData){
        var firstRow = '<div class="row"><div class="col-md-3">' + formatUsage(volumeData["volumeName"]) + '</div>' + '<div class="col-md-9">' + formatRWSpeed(volumeData["volumeName"]) + '</div></div>';
        return firstRow;
    }

    function formatUsage(volumeName){
        return '<div class="box box-primary"><div class="box-header with-border"><i class="fa fa-bar-chart-o"></i><h3 class="box-title">存储卷容量</h3><div class="box-tools pull-right"><button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button></div></div><div class="box-body"><div id="' + volumeName + 'Usage" style="height: 150px; width:100%"></div></div></div>'
    }

    function formatRWSpeed(volumeName){
        return '<div class="box box-primary"><div class="box-header with-border"><i class="fa fa-bar-chart-o"></i><h3 class="box-title">IO读写速度</h3><div class="box-tools pull-right"><button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button></div></div><div class="box-body" id="rwBox"><div id="' + volumeName + 'rwSpeed" style="height: 150px; width: 100%"></div></div></div>';
    }

    function contentSecondRow(volumeData){
        return '<div class="row"><div class="col-md-5">' + formatOperation(volumeData["volumeName"], volumeData["status"]) + '</div><div class="col-md-7">' + formatClientTable(volumeData["volumeName"]) + '</div></div>';
    }

    function formatOperation(volumeName, status){
        if (status == 'running'){
            return '<div class="box box-primary"><div class="box-header with-border"><h3 class="box-title">存储卷操作</h3></div><div class="box-body table-responsive no-padding" style="color: black;height: 158px"><div class="row" style="text-align: center;margin-top: 39px;width: 100%"><button class="btn btn-app" id="' + volumeName +'Start" disabled><i class="fa fa-play"></i> 启动</button><button class="btn btn-app" id="' + volumeName + 'Restart"><i class="fa fa-repeat"></i> 重启</button><button class="btn btn-app" id="' + volumeName + 'Stop"><i class="fa fa-pause"></i> 停止</button></div></div></div>';

        } else {
            return '<div class="box box-primary"><div class="box-header with-border"><h3 class="box-title">存储卷操作</h3></div><div class="box-body table-responsive no-padding" style="color: black;height: 158px"><div class="row" style="text-align: center;margin-top: 39px;width: 100%"><button class="btn btn-app" id="' + volumeName +'Start"><i class="fa fa-play"></i> 启动</button><button class="btn btn-app" id="' + volumeName + 'Restart"><i class="fa fa-repeat"></i> 重启</button><button class="btn btn-app" id="' + volumeName + 'Stop" disabled><i class="fa fa-pause"></i> 停止</button></div></div></div>';

        }
    }

    function formatClientTable(volumeName){
        return '<table data-toggle="table" data-unique-id="client" id="' + volumeName + 'ClientTable"><thead><tr><th data-align="center" data-field="ck">fer</th><th data-align="center" data-field="client">客户端</th><th data-align="center" data-field="address">网址</th><th data-align="center" data-field="username">用户名</th><th data-align="center" data-field="password">密码</th></tr></thead><tbody></tbody></table>';
    }

    function appendNewVolume(newVolumeData, i){
        var volumeTabs = $('#volumeTabs');
        var volumeContent = $('#volumeContent');
        var removeButton = $('#removeVolume');
        volumeTabs.append(volumeTabFormat(newVolumeData["volumeName"], i));
    }

</script>
<script>


    Highcharts.setOptions({
        global: {
            useUTC: false
        }
    });
    $('#CPUtfs00').highcharts({
        credits: {
            enabled: false
        },
        chart: {
            type: 'line',
            animation: false, // don't animate in old IE
            events: {
                load: function (event) {
                    var series = this.series[0];
                    var series1 = this.series[1];
                    setInterval(function () {
                        var x = (new Date()).getTime(), // current time
                                y = Math.random();//y get from background
                        series.addPoint([x, y], true, true);
                        series1.addPoint([x, Math.random()], true, true);
                    }, 1000);
                }
            }
        },
        xAxis: {
            type: 'datetime',
            tickPixelInterval: 150,
            minPadding: 0,
            maxPadding: 0
        },
        yAxis: {
            title: {
                text: 'MB/s'
            },
            plotLines: [{
                value: 0,
                width: 1,
                color: '#808080'
            }]
        },
        tooltip: {
            formatter: function () {
                return '<b>' + this.series.name + '</b><br/>' +
                        Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
                        Highcharts.numberFormat(this.y, 2);
            },
            crosshairs: true
        },
        plotOptions: {
            series: {
                dataLabels: {
                    allowOverlap: true
                }
            }
        },
        title : {
            text : ""
        },
        legend: {
            enabled: true
        },
        exporting: {
            enabled: false
        },
        series: [{
            name: '读',
            data: (function () {
                // generate an array of random data
                var data = [],
                        time = (new Date()).getTime(),
                        i;
                for (i = -19; i <= 0; i += 1) {
                    data.push({
                        x: time + i * 5000,
                        y: Math.random()
                    });
                }
                return data;
            }())
        }, {
            name: '写',
            data: (function () {
                // generate an array of random data
                var data = [],
                        time = (new Date()).getTime(),
                        i;
                for (i = -19; i <= 0; i += 1) {
                    data.push({
                        x: time + i * 1000,
                        y: Math.random()
                    });
                }
                return data;
            }()),
            color : '#6FDB4B'
        }]
    });

</script>

{% endblock %}
